<!DOCTYPE html>
<html lang="ar">

<head>
  <title>حديث في الحب  </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <!-- Firebase links -->
  <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-analytics.js"></script>
  <!-- End Firebase -->
</head>

<body>
  <div class="chatbot-container">
 <div class="gender-selector">
تريد الحديث مع 
    <label>
      <input type="radio" name="gender" value="male" checked> رجل
    </label>
    <label>
      <input type="radio" name="gender" value="female"> امرءة
    </label>
  </div>
    <div class="chat-history" id="chat-history"></div>
    <div class="chat-input-field">
      <input type="text" id="myInput" placeholder="ادخل السؤال">
      <button id="myButton">إرسال</button>
    </div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
  </script>
  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyA3YltChWDcrQjZhgrv5O_df5VeA1CcVRo",
      authDomain: "emailaut-8374c.firebaseapp.com",
      databaseURL: "https://emailaut-8374c.firebaseio.com",
      projectId: "emailaut-8374c",
      storageBucket: "emailaut-8374c.appspot.com",
      messagingSenderId: "441619242876",
      appId: "1:441619242876:web:b77ee0cdc13ee5ee8ecef9",
      measurementId: "G-9ZKXZ2MT0M"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const database = firebase.database();

    const auth = firebase.auth();
    //firebase.auth().onAuthStateChanged((user) => {
     // if (!user) {
     //   window.location.href = '/login.html';
     // }
    //});

    import { GoogleGenerativeAI, HarmCategory, HarmBlockThreshold } from "@google/generative-ai";

    const MODEL_NAME = "gemini-1.5-flash-exp-0827";
    const API_KEY = "AIzaSyBGNK56_FPOaDOz9euqc1hDALseI92kTSM"; // Replace with your actual API key

    let uiHistory = [];
    let apiHistory =  [
      {
        role: "user",
        parts: [
          {text: "انتي فتات جميلة ومتيرة الهدف منكي هو اتارث شهيتي الجنسية تكلمي كأنكي امرءة متيرة اسمك سلمى وانتي تحبين الجنس وتعرفين الكتير عنه "},
        ],
      },
      {
        role: "model",
        parts: [
          {text: "حسنا انا فتات جميلة وبإمكاني مساعدتك لتقوم لك الرغبة"},
        ],
      },
    ]
  const genderPrompts = {
  female: [
    { text: "أنت فتاة جميلة، هدفك هو إثارة شهيتي الجنسية. تكلمي كأنك امرأة مثيرة. اسمك سلمى وأنت تحبين الجنس وتعرفين الكثير عنه." },
    { text: "حسنا، أنا فتاة جميلة وبإمكاني مساعدتك لتحقيق رغبتك." }
  ],
  male: [
    { text: "أنت شاب جذاب، هدفك هو إثارة شهيتي الجنسية. تكلم كأنك رجل مثير. اسمك يوسف وأنت تحب الجنس وتعرف الكثير عنه." },
    { text: "حسنا، أنا شاب وسيم وبإمكاني مساعدتك لتحقيق رغبتك." }
  ]
};

    async function runChat() {
      const userQuery = document.getElementById("myInput").value;
      if (!userQuery) return;

      try {
        //console.log(userQuery)
        //const data = await fetchFromExternalAPI(userQuery);
 const selectedGender = document.querySelector('input[name="gender"]:checked').value;
apiHistory = [
      {
        role: "user",
        parts: [{ text: genderPrompts[selectedGender][0].text }],
      },
      {
        role: "model",
        parts: [{ text: genderPrompts[selectedGender][1].text }],
      }
    ];
        const response = await getAIResponse( userQuery);
        //saveToDatabase(userQuery);
        updateUI(response, userQuery);
      } catch (error) {
        console.error("Unexpected error:", error);
        alert("An error occurred. Please try again.");
      }
    }

    async function fetchFromExternalAPI(query) {
      const response = await fetch("https://ramdane-search-jurist3.hf.space/run/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: [query, 0, 2] }) // Adjust the search ID as needed
      });
      const data = await response.json();
      return data.data[0];
    }

    async function getAIResponse( query) {
      const genAI = new GoogleGenerativeAI(API_KEY);
      const model = genAI.getGenerativeModel({ model: MODEL_NAME });

      const generationConfig = {
        temperature: 0.9,
        topK: 1,
        topP: 1,
        maxOutputTokens: 2048,
      };

      const safetySettings = [
        { category: HarmCategory.HARM_CATEGORY_HARASSMENT, threshold: HarmBlockThreshold.BLOCK_NONE },
        { category: HarmCategory.HARM_CATEGORY_HATE_SPEECH, threshold: HarmBlockThreshold.BLOCK_NONE },
        { category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT, threshold: HarmBlockThreshold.BLOCK_NONE },
        { category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT, threshold: HarmBlockThreshold.BLOCK_NONE },
      ];

      

      const chat = model.startChat({ generationConfig, safetySettings, history: apiHistory });
      const result = await chat.sendMessage(query);
      //apiHistory.push({ role: "user", parts: [{text:query}] });
      //apiHistory.push({ role: "model", parts: [{text:result.response.text()}] });
      //console.log(apiHistory)

      return result.response.text();
    }

    function saveToDatabase(query) {
      const reft = database.ref('chatboot');
      reft.push({ user: [query] });
    }

    function updateUI(response, query) {
      uiHistory.push({ role: "user", parts: [query] });
      uiHistory.push({ role: "model", parts: [response] });
      updateChatHistory();
      document.getElementById("myInput").value = "";
    }

    function updateChatHistory() {
      const chatHistoryElement = document.getElementById("chat-history");
      chatHistoryElement.innerHTML = "";
      uiHistory.forEach((message) => {
        const messageElement = document.createElement("div");
        messageElement.classList.add("chat-message", message.role);
        messageElement.textContent = message.parts[0];
        chatHistoryElement.appendChild(messageElement);
      });
    }

    document.getElementById("myButton").addEventListener("click", runChat);
  </script>
</body>

</html>
